# Google Maps ç·åˆé–‹ç™ºã‚¬ã‚¤ãƒ‰

> **ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆã«ã¤ã„ã¦**  
> ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ã‚³ãƒ¼ãƒ‰ä¾‹ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã€å®Ÿè£…ä¾‹ã¯å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ã§å‚ç…§ã—ã¦ã„ã¾ã™ã€‚  
> æœ€æ–°ã®å®Ÿè£…è©³ç´°ã¯ã€å„ãƒªãƒ³ã‚¯å…ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

## ğŸ“‹ ç›®æ¬¡

1. [é–‹ç™ºã®åŸºæœ¬æ–¹é‡](#development-basics)
2. [APIæœ€é©åŒ–è¨­å®š](#api-optimization)
3. [ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°](#marker-clustering)
4. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#performance-optimization)
5. [ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³](#current-implementation)
6. [ç›£è¦–ã¨åˆ†æ](#monitoring-analysis)
7. [é–‹ç™ºæ™‚ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#best-practices)

---

## ğŸ¯ é–‹ç™ºã®åŸºæœ¬æ–¹é‡ {#development-basics}

### ãƒãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ã®é¸æŠæŒ‡é‡

#### âœ… Uncontrolled ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ¨å¥¨ï¼‰

**å®Ÿè£…ä¾‹**: [`src/components/Map.tsx`](../src/components/Map.tsx) - Line 433-447

åŸºæœ¬çš„ãªãƒãƒƒãƒ—è¨­å®šä¾‹ï¼š

- `defaultZoom`: SADO_ISLANDå®šæ•°ã«ã‚ˆã‚‹åˆæœŸã‚ºãƒ¼ãƒ è¨­å®š
- `defaultCenter`: ä½æ¸¡å³¶ä¸­å¿ƒåº§æ¨™
- `mapTypeId`: TERRAINè¡¨ç¤ºã®è¨­å®š
- `gestureHandling`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã®åˆ¶å¾¡

**ä½¿ç”¨å ´é¢ï¼š**

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«ãƒãƒƒãƒ—ã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„
- ä¸€èˆ¬çš„ãªãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ã‚¢
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªåœ°å›³ã‚¢ãƒ—ãƒª

#### âš ï¸ Controlled ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ…é‡ã«ä½¿ç”¨ï¼‰

**å®Ÿè£…ä¾‹**: [`src/components/Map.tsx`](../src/components/Map.tsx) - Line 58,
81-87

Controlled ãƒ¢ãƒ¼ãƒ‰ã§ã®ã‚ºãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ï¼š

- `useState`ã§ã‚ºãƒ¼ãƒ çŠ¶æ…‹ã‚’ç®¡ç†
- `onCameraChanged`ã‚¤ãƒ™ãƒ³ãƒˆã§ã®çŠ¶æ…‹åŒæœŸ
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆ¶å¾¡ãŒå¯èƒ½

**ä½¿ç”¨å ´é¢ï¼š**

- ãƒãƒƒãƒ—ã®çŠ¶æ…‹ã‚’å³å¯†ã«ç®¡ç†ã—ãŸã„
- å¤–éƒ¨ã‹ã‚‰ãƒãƒƒãƒ—ã‚’æ“ä½œã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãƒ—ãƒ­ã‚°ãƒ©ãƒ åˆ¶å¾¡ãŒå¿…è¦

### å¿…é ˆè¨­å®šé …ç›®

#### åŸºæœ¬è¨­å®š

**è¨­å®šå€¤ã®å‚ç…§**: [`src/constants/index.ts`](../src/constants/index.ts) -
SADO_ISLANDå®šæ•°

**å®Ÿè£…ä¾‹**: [`src/components/Map.tsx`](../src/components/Map.tsx) - Line 433-447

ä¸»è¦ãªè¨­å®šé …ç›®ï¼š

- **defaultZoom**: `SADO_ISLAND.ZOOM.DEFAULT`
  (11) - ä½æ¸¡å³¶å…¨ä½“ãŒè¦‹ãˆã‚‹æœ€é©ãªã‚ºãƒ¼ãƒ 
- **defaultCenter**: `SADO_ISLAND.CENTER` - ä½æ¸¡å³¶ã®åœ°ç†çš„ä¸­å¿ƒç‚¹
- **mapId**: ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹Map IDè¨­å®šï¼ˆã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ç”¨ï¼‰
- **mapTypeId**: `google.maps.MapTypeId.TERRAIN` - åœ°å½¢è¡¨ç¤º
- **gestureHandling**: `"greedy"` - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ“ä½œã®åˆ¶å¾¡
- **reuseMaps**: `true` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã®ãƒãƒƒãƒ—ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†åˆ©ç”¨

---

## ğŸš€ APIæœ€é©åŒ–è¨­å®š {#api-optimization}

### 1. APIProvider ã®æœ€é©åŒ–

```tsx
// APIã‚­ãƒ¼ã‚’ãƒ¡ãƒ¢åŒ–ã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
const apiKey = useMemo(() => import.meta.env["VITE_GOOGLE_MAPS_API_KEY"], []);
// ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¨­å®šã‚’ãƒ¡ãƒ¢åŒ– - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
const libraries = useMemo(() => ["marker"], []);
const version = useMemo(() => "weekly", []); // æœ€æ–°ã®å®‰å®šç‰ˆã‚’ä½¿ç”¨

<APIProvider
  apiKey={apiKey}
  version={version}
  libraries={libraries}
  language="ja"
  region="JP"
  onLoad={handleMapReady}
>
```

**æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆï¼š**

- `useMemo`ã‚’ä½¿ç”¨ã—ã¦APIã‚­ãƒ¼ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¨­å®šã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ¡ãƒ¢åŒ–
- `libraries={['marker']}`: å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ã‚’æ˜ç¤ºçš„ã«èª­ã¿è¾¼ã¿
- `version="weekly"`: æœ€æ–°ã®å®‰å®šç‰ˆAPIã‚’ä½¿ç”¨
- `language="ja"`: æ—¥æœ¬èªå¯¾å¿œ
- `region="JP"`: æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š
- `onLoad` ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©: èª­ã¿è¾¼ã¿å®Œäº†ã®ç›£è¦–

### 2. ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®æ”¹å–„

**å®Ÿè£…ä¾‹**: [`src/services/preload.ts`](../src/services/preload.ts)

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®å®Ÿè£…**: [`src/App.tsx`](../src/App.tsx) - Line 51-55

æ”¹å–„å†…å®¹ï¼š

- **useMemoæ´»ç”¨**: ãƒ¡ãƒ¢åŒ–ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- **éåŒæœŸèª­ã¿è¾¼ã¿**: `loading=async`ã«ã‚ˆã‚‹æœ€é©åŒ–
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š**: `version="weekly"`ã§æœ€æ–°å®‰å®šç‰ˆä½¿ç”¨
- **åœ°åŸŸè¨­å®š**: æ—¥æœ¬èªãƒ»ãƒªãƒ¼ã‚¸ãƒ§ãƒ³æœ€é©åŒ–

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š

**å®Ÿè£…ä¾‹**: [`src/components/Map.tsx`](../src/components/Map.tsx) - Line 49-52

é‡è¦ãªè¨­å®šé …ç›®ï¼š

- **reuseMaps**: ãƒãƒƒãƒ—ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å†åˆ©ç”¨
- **language/region**: åœ°åŸŸæœ€é©åŒ–
- **onLoad**: èª­ã¿è¾¼ã¿å®Œäº†ã®ç›£è¦–

---

## ğŸ¯ ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚° {#marker-clustering}

### å®Ÿè£…æ¸ˆã¿æ”¹å–„å†…å®¹

#### 1. ğŸ¨ è¦–è¦šçš„å·®åˆ¥åŒ–ã®å¼·åŒ–

- **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒ¼ã‚«ãƒ¼**: ã‚µã‚¤ã‚ºã¨è‰²ã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ãƒãƒ¼ã‚«ãƒ¼æ•°ã‚’è¡¨ç¾
  - 2-5ä»¶: ã‚ªãƒ¬ãƒ³ã‚¸è‰² (#FF6B35)ã€ã‚¹ã‚±ãƒ¼ãƒ«1.2å€
  - 6-9ä»¶: ãƒ€ãƒ¼ã‚¯ã‚ªãƒ¬ãƒ³ã‚¸è‰² (#FF8C00)ã€ã‚¹ã‚±ãƒ¼ãƒ«1.3å€
  - 10ä»¶ä»¥ä¸Š: èµ¤è‰² (#E53E3E)ã€ã‚¹ã‚±ãƒ¼ãƒ«1.5å€
- **å€‹åˆ¥ãƒãƒ¼ã‚«ãƒ¼**: é’è‰² (#4285F4) ã§Google Mapsãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«
- **æ•°å­—è¡¨ç¤º**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒ¼ã‚«ãƒ¼ã«æ–½è¨­æ•°ã‚’ç™½æ–‡å­—ã§è¡¨ç¤º

#### 2. ğŸ” ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«å¯¾å¿œã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
[`src/components/GoogleMarkerCluster.tsx`](../src/components/GoogleMarkerCluster.tsx)

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ**: Line 240-252 **ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆæœ€é©åŒ–**: Line 140-160
**åœ°ç†è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: [`src/utils/geo.ts`](../src/utils/geo.ts)

ä¸»è¦ãªæ©Ÿèƒ½ï¼š

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**: ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã§é‡è¤‡è¨ˆç®—å›é¿
- **ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆæœ€é©åŒ–**: è¡¨ç¤ºé ˜åŸŸå†…ã®POIã®ã¿å‡¦ç†
- **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åˆ†é›¢**: GeoUtilsã‚¯ãƒ©ã‚¹ã§ã®åœ°ç†è¨ˆç®—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: ã‚ºãƒ¼ãƒ å¤‰æ›´æ™‚ã®å³åº§ãªå†è¨ˆç®—
- **ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†**: useDebounceãƒ•ãƒƒã‚¯ã«ã‚ˆã‚‹é »ç¹æ›´æ–°åˆ¶å¾¡

#### 3. ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**:
[`src/components/GoogleMarkerCluster.tsx`](../src/components/GoogleMarkerCluster.tsx)

**ãƒ¡ãƒ¢åŒ–å®Ÿè£…**: Line 360-370 (React.memo), Line 390+ (useMemo), Line 410+
(useCallback) **ãƒ‡ãƒã‚¦ãƒ³ã‚¹å®Ÿè£…**: Line 36-45 (useDebounce hook)
**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹**: [`src/services/cache.ts`](../src/services/cache.ts)

æœ€é©åŒ–æ‰‹æ³•ï¼š

- **React.memo**: MarkerComponentã®ãƒ¡ãƒ¢åŒ–ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæœ€é©åŒ–
- **useMemo**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°çµæœã®ãƒ¡ãƒ¢åŒ–ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨
- **useCallback**: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ãƒ¡ãƒ¢åŒ–
- **ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†**: 150msãƒ‡ãƒã‚¦ãƒ³ã‚¹ã«ã‚ˆã‚‹ã‚ºãƒ¼ãƒ å¤‰æ›´ã®é »ç¹æ›´æ–°åˆ¶å¾¡

#### 4. ğŸ¯ ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š

- **è©³ç´°ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒãƒ¼ã‚«ãƒ¼ã«ã€Œã€œä»¶ã®æ–½è¨­ãŒé›†ã¾ã£ã¦ã„ã¾ã™ã€ã¨è¡¨ç¤º
- **è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã«ã‚ˆã‚‹è‰²ã¨ã‚µã‚¤ã‚ºã®æ®µéšçš„å¤‰åŒ–
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ**: ã‚ºãƒ¼ãƒ æ“ä½œã«å¯¾ã™ã‚‹ãƒãƒ¼ã‚«ãƒ¼ã®å‹•çš„ãªåˆ†é›¢ãƒ»çµ±åˆ
- **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯å‡¦ç†**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼é¸æŠæ™‚ã®è‡ªå‹•ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ©Ÿèƒ½
- **ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ‘ãƒ³ã¨ã‚ºãƒ¼ãƒ ã®æ®µéšçš„å®Ÿè¡Œã§UXå‘ä¸Š

---

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– {#performance-optimization}

### å®Ÿè£…æ¸ˆã¿ã®æ”¹å–„

#### 1. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ + ã‚¿ã‚¤ãƒˆãƒ«ç”»åƒè¡¨ç¤º

- ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«å³åº§ã«ç¾ã—ã„ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤º
- `title_row1.png`ã‚’ä½¿ç”¨ã—ãŸãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

#### 2. ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: [`src/services/cache.ts`](../src/services/cache.ts)

**è¨­å®šå®šæ•°**: [`src/constants/index.ts`](../src/constants/index.ts) -
CACHE_CONFIG

ä¸»è¦ãªæ©Ÿèƒ½ï¼š

- **çµ±åˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹**: å˜ä¸€ã®CacheServiceã‚¯ãƒ©ã‚¹ã§ä¸€å…ƒç®¡ç†
- **LRUæ–¹å¼**: æœ€å¤§ã‚¨ãƒ³ãƒˆãƒªæ•°åˆ¶é™ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªãƒ¡ãƒ¢ãƒªç®¡ç†
- **æœ‰åŠ¹æœŸé™åˆ¶å¾¡**: ã‚¢ã‚¤ãƒ†ãƒ åˆ¥ã®æœ‰åŠ¹æœŸé™è¨­å®š
- **å‹å®‰å…¨ãªå–å¾—**: typeGuardã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿å–å¾—
- **è‡ªå‹•ã‚µã‚¤ã‚ºç®¡ç†**: enforceSize()ã«ã‚ˆã‚‹å¤ã„ã‚¨ãƒ³ãƒˆãƒªè‡ªå‹•å‰Šé™¤

#### 3. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: [`src/components/Map.tsx`](../src/components/Map.tsx)

**ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š**: Line 40-45 (ANIMATION_CONFIGå®šæ•°)
**ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯å‡¦ç†**: Line 147-177 (zoomToClusteré–¢æ•°)

è¨­å®šå€¤ã¨å®Ÿè£…ï¼š

- **PAN_DELAY**: 400ms - ãƒ‘ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾…ã¡æ™‚é–“
- **ZOOM_STEPS**: ã‚ºãƒ¼ãƒ 1ãƒ¬ãƒ™ãƒ«ã‚ãŸã‚Š4ã‚¹ãƒ†ãƒƒãƒ—ã§æ»‘ã‚‰ã‹ãªç§»è¡Œ
- **æ®µéšçš„å®Ÿè¡Œ**: ãƒ‘ãƒ³â†’ã‚ºãƒ¼ãƒ ã®é †æ¬¡å®Ÿè¡Œã§UXå‘ä¸Š
- **æœ€é©ã‚ºãƒ¼ãƒ è¨ˆç®—**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…POIåˆ†å¸ƒã«åŸºã¥ãé©åˆ‡ãªã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ç®—å‡º

### æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„åŠ¹æœ

#### 1. èª­ã¿è¾¼ã¿æ™‚é–“ã®çŸ­ç¸®

- **æ”¹å–„å‰**: Maps API ã®åŒæœŸèª­ã¿è¾¼ã¿ã«ã‚ˆã‚‹æ€§èƒ½ä½ä¸‹
- **æ”¹å–„å¾Œ**:
  `version="weekly"`æŒ‡å®šã¨éåŒæœŸèª­ã¿è¾¼ã¿ã€å¿…è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ã®èª­ã¿è¾¼ã¿
- **å®Ÿè£…æ¸ˆã¿**: useMemoã«ã‚ˆã‚‹APIã‚­ãƒ¼ãƒ»è¨­å®šã®ãƒ¡ãƒ¢åŒ–ã§å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–

#### 2. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–

- ãƒãƒƒãƒ—ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å†åˆ©ç”¨ï¼ˆ`reuseMaps={true}`ï¼‰
- React.memoã€useMemoã€useCallbackã«ã‚ˆã‚‹ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é˜²æ­¢
- LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†

#### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š

- æ—¥æœ¬èªãƒ»æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«æœ€é©åŒ–
- ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®æ”¹å–„
- ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ã«ã‚ˆã‚‹å¿œç­”æ€§å‘ä¸Š

### ã•ã‚‰ãªã‚‹æœ€é©åŒ–æ¡ˆ

#### A. ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æœ€é©åŒ–

```typescript
// ä¸¦è¡Œãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆç¾åœ¨ã¯é †æ¬¡å–å¾—ï¼‰
const promises = sheetConfigs.map((config) =>
  this.fetchSheetData(config.name, "A:Z"),
);
const results = await Promise.allSettled(promises);
```

#### B. Service Worker ã«ã‚ˆã‚‹ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥

- é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šã‚­ãƒ£ãƒƒã‚·ãƒ¥
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®åŸºæœ¬æ©Ÿèƒ½æä¾›

#### C. ä»®æƒ³åŒ–ï¼ˆå¤§é‡ãƒãƒ¼ã‚«ãƒ¼å¯¾å¿œï¼‰

- è¡¨ç¤ºé ˜åŸŸå†…ã®ãƒãƒ¼ã‚«ãƒ¼ã®ã¿ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å‰Šæ¸›

#### D. Progressive Web App å¯¾å¿œ

- ã‚¢ãƒ—ãƒªãƒ©ã‚¤ã‚¯ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ãª Web ã‚¢ãƒ—ãƒª

- Bundle æœ€é©åŒ–

```typescript
// Dynamic import ã§ã‚³ãƒ¼ãƒ‰åˆ†å‰²
const { MarkerCluster } = await import("./MarkerCluster");
```

---

## ğŸ—ï¸ ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ {#current-implementation}

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```text
src/
  components/
    Map.tsx                    # ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒ—ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    GoogleMarkerCluster.tsx    # ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
    InfoWindow.tsx             # æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
    LazyMap.tsx               # é…å»¶èª­ã¿è¾¼ã¿ãƒ©ãƒƒãƒ‘ãƒ¼
  constants/
    index.ts                  # å®šæ•°å®šç¾©ï¼ˆSADO_ISLAND, CACHE_CONFIGç­‰ï¼‰
  services/
    cache.ts                  # çµ±åˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹
    sheets.ts                 # Google Sheets APIé€£æº
    preload.ts                # ã‚¢ã‚»ãƒƒãƒˆãƒ—ãƒªãƒ­ãƒ¼ãƒ‰
  types/
    google-maps.ts            # Google Mapsé–¢é€£å‹å®šç¾©
    common.ts                 # å…±é€šå‹å®šç¾©
  utils/
    geo.ts                    # åœ°ç†è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    assets.ts                 # ã‚¢ã‚»ãƒƒãƒˆç®¡ç†
```

### ä¸»è¦ãªå®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

#### 1. é«˜åº¦ãªãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°

- **ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆæœ€é©åŒ–**: è¡¨ç¤ºé ˜åŸŸå†…ã®POIã®ã¿å‡¦ç†
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**: ãƒãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã®åŠ¹ç‡çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- **ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†**: ã‚ºãƒ¼ãƒ å¤‰æ›´æ™‚ã®éåº¦ãªå†è¨ˆç®—ã‚’é˜²æ­¢
- **è¦–è¦šçš„å·®åˆ¥åŒ–**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã«å¿œã˜ãŸè‰²ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«å¤‰æ›´

#### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- **React.memo**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã®ãƒ¡ãƒ¢åŒ–
- **useMemo/useCallback**: é©åˆ‡ãªãƒ•ãƒƒã‚¯ä½¿ç”¨
- **LRUã‚­ãƒ£ãƒƒã‚·ãƒ¥**: ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ç®¡ç†
- **ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**: ä¸è¦ãªã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

#### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

- **ã‚¹ãƒãƒ¼ãƒˆã‚ºãƒ¼ãƒ **: ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯æ™‚ã®æœ€é©ãªã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«è¨ˆç®—
- **ã‚¹ãƒ ãƒ¼ã‚ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ‘ãƒ³â†’ã‚ºãƒ¼ãƒ ã®æ®µéšçš„å®Ÿè¡Œ
- **InfoWindowåˆ¶å¾¡**: å¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯ã§ã®è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚º
- **åœ°å½¢è¡¨ç¤º**: ä½æ¸¡å³¶ã®åœ°ç†ã«é©ã—ãŸTERRAINãƒ¢ãƒ¼ãƒ‰

#### 4. è¨­å®šç®¡ç†

- **ç’°å¢ƒå¤‰æ•°**: Viteç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†
- **å®šæ•°å®šç¾©**: SADO_ISLANDè¨­å®šã§ã®ä¸€å…ƒç®¡ç†
- **å‹å®‰å…¨æ€§**: TypeScriptå‹å®šç¾©ã«ã‚ˆã‚‹å“è³ªä¿è¨¼

### ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»ä¾å­˜é–¢ä¿‚

```json
{
  "@vis.gl/react-google-maps": "^1.5.2", // React Google Maps
  "@googlemaps/markerclusterer": "^2.5.3", // å…¬å¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ï¼ˆè£œåŠ©ï¼‰
  "react": "19.1.0", // React 19
  "react-dom": "19.1.0" // React DOM
}
```

### ç¾åœ¨ã®è¨­å®šå€¤

**å®šæ•°ãƒ•ã‚¡ã‚¤ãƒ«**: [`src/constants/index.ts`](../src/constants/index.ts)

#### SADO_ISLANDè¨­å®š

ä¸»è¦ãªè¨­å®šå€¤ï¼š

- **CENTER**: `{ lat: 38.0549, lng: 138.3691 }` - ä½æ¸¡å³¶ã®åœ°ç†çš„ä¸­å¿ƒ
- **DEFAULT_ZOOM**: `11` - ä½æ¸¡å³¶å…¨ä½“è¡¨ç¤ºã«æœ€é©ãªã‚ºãƒ¼ãƒ 
- **ZOOMç¯„å›²**: MIN(9) ï½ MAX(18) - æ“ä½œå¯èƒ½ãªç¯„å›²
- **CLUSTERINGåˆ¶å¾¡**: MIN_CLUSTER_ZOOM(8), DISABLE_CLUSTERING(14)
- **MARKERåˆ¶é™**: NORMAL_ZOOM(200), HIGH_ZOOM(500) - è¡¨ç¤ºãƒãƒ¼ã‚«ãƒ¼æ•°åˆ¶é™

#### CACHE_CONFIGè¨­å®š

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã®è¨­å®šï¼š

- **DEFAULT_EXPIRY**: 15åˆ† - æ¨™æº–çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™
- **SHEETS_TTL**: 1æ™‚é–“ - Google Sheetsãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **IMAGES_TTL**: 24æ™‚é–“ - ç”»åƒãƒªã‚½ãƒ¼ã‚¹ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **MAX_ENTRIES**: 100 - æœ€å¤§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ãƒˆãƒªæ•°

### å®Ÿè£…æ¸ˆã¿ã®æœ€é©åŒ–

#### ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æœ€é©åŒ–

- ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¢ƒç•Œãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹å‡¦ç†å¯¾è±¡çµã‚Šè¾¼ã¿
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®ãƒãƒƒã‚·ãƒ¥åŒ–ã«ã‚ˆã‚‹é«˜é€Ÿæ¤œç´¢
- ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ï¼ˆ150msï¼‰ã«ã‚ˆã‚‹é »ç¹ãªæ›´æ–°åˆ¶å¾¡

#### ãƒ¡ãƒ¢ãƒªç®¡ç†æœ€é©åŒ–

- LRUæ–¹å¼ã«ã‚ˆã‚‹å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ãƒˆãƒªè‡ªå‹•å‰Šé™¤
- MutationObserverã«ã‚ˆã‚‹DOMè¦ç´ ã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- useEffectä¾å­˜é…åˆ—ã®æœ€é©åŒ–

#### ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æœ€é©åŒ–

- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯æ™‚ã®æ®µéšçš„ã‚ºãƒ¼ãƒ ï¼ˆãƒ‘ãƒ³400mså¾…æ©Ÿâ†’ã‚ºãƒ¼ãƒ ï¼‰
- InfoWindowå¤–éƒ¨ã‚¯ãƒªãƒƒã‚¯æ¤œå‡ºã«ã‚ˆã‚‹è‡ªå‹•ã‚¯ãƒ­ãƒ¼ã‚º
- Google Mapsæ¨™æº–ã‚¢ã‚¤ã‚³ãƒ³ã¨ã®å…±å­˜åˆ¶å¾¡

---

## ğŸ” ç›£è¦–ã¨åˆ†æ {#monitoring-analysis}

### é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã®ç¢ºèª

#### 1. Network ã‚¿ãƒ–

- Maps API ã®èª­ã¿è¾¼ã¿æ–¹æ³•ã®ç¢ºèª
- `version=weekly` ã®åŠ¹æœç¢ºèª
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸¦è¡Œèª­ã¿è¾¼ã¿çŠ¶æ³

#### 2. Console ãƒ­ã‚°

**å®Ÿè£…ä¾‹**: [`src/components/Map.tsx`](../src/components/Map.tsx) - Line 81-87

**ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ç›£è¦–**:
[`src/components/GoogleMarkerCluster.tsx`](../src/components/GoogleMarkerCluster.tsx) -
Line 390+

é–‹ç™ºæ™‚ã®ãƒ­ã‚°å‡ºåŠ›ï¼š

- **ã‚ºãƒ¼ãƒ å¤‰æ›´ç›£è¦–**: `handleCameraChanged`ã§ã®ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«å¤‰åŒ–è¿½è·¡
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ç›£è¦–**: ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ’ãƒƒãƒˆ/ãƒŸã‚¹çŠ¶æ³
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š**: è¨ˆç®—æ™‚é–“ã®æ¸¬å®šã¨ãƒ­ã‚°å‡ºåŠ›

#### 3. Performance ã‚¿ãƒ–

- ãƒãƒ¼ã‚«ãƒ¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
- React DevToolsã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åˆ†æ
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›£è¦–

### ç›£è¦–ã™ã¹ãæŒ‡æ¨™

1. **åˆæœŸèª­ã¿è¾¼ã¿æ™‚é–“**

   - Google Maps API ã®èª­ã¿è¾¼ã¿å®Œäº†æ™‚é–“
   - æœ€åˆã®ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºã¾ã§ã®æ™‚é–“
   - POIãƒ‡ãƒ¼ã‚¿ã®å–å¾—æ™‚é–“

2. **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å¿œç­”æ€§**

   - ã‚ºãƒ¼ãƒ æ“ä½œã®å¿œç­”æ™‚é–“ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹150msè€ƒæ…®ï¼‰
   - ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã®å¿œç­”æ™‚é–“
   - ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“

3. **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**

   - ãƒãƒ¼ã‚«ãƒ¼æ•°å¢—åŠ æ™‚ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¨ãƒ³ãƒˆãƒªæ•°ã¨ãƒ¡ãƒ¢ãƒªåŠ¹ç‡
   - DOMè¦ç´ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—çŠ¶æ³

4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡**
   - ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ’ãƒƒãƒˆç‡
   - POIãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹æ€§
   - LRUå‰Šé™¤ã®ç™ºç”Ÿé »åº¦

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã®ã‚³ãƒ¼ãƒ‰ä¾‹

**å®Ÿè£…æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆé–‹ç™ºæ™‚ã®ã¿ä½¿ç”¨æ¨å¥¨ï¼‰
const measurePerformance = (name: string, fn: () => void) => {
  if (import.meta.env.DEV) {
    const start = performance.now();
    fn();
    const end = performance.now();
    console.log(`${name}: ${end - start}ms`);
  } else {
    fn();
  }
};

// ä½¿ç”¨ä¾‹
measurePerformance("Clustering calculation", () => {
  const result = computeClusters(pois, zoomLevel);
});
```

---

## ğŸ¯ é–‹ç™ºæ™‚ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ {#best-practices}

### 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

- Google Mapsé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯`React.memo`ã§ãƒ¡ãƒ¢åŒ–
- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯`useCallback`ã§æœ€é©åŒ–
- é‡ã„è¨ˆç®—ã¯`useMemo`ã§ãƒ¡ãƒ¢åŒ–
- å‹å®‰å…¨æ€§ã‚’é‡è¦–ã—ãŸTypeScriptæ´»ç”¨

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å®Ÿè£…ä¾‹**: [`src/components/Map.tsx`](../src/components/Map.tsx)

åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š

```typescript
const handleMapError = (error: any) => {
  console.error("Google Maps Error:", error);
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º
  // ä¾‹ï¼šãƒˆãƒ¼ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ã‚¨ãƒ©ãƒ¼ãƒãƒŠãƒ¼ã®è¡¨ç¤º
};
```

### 3. ãƒ‡ãƒãƒƒã‚°æ”¯æ´

- é–‹ç™ºç’°å¢ƒã§ã®ã¿è©³ç´°ãƒ­ã‚°ã‚’å‡ºåŠ›
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã®å¯è¦–åŒ–
- ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã®çŠ¶æ…‹è¡¨ç¤º

### 4. ç¾åœ¨ã®å®Ÿè£…ã«ãŠã‘ã‚‹æ³¨æ„ç‚¹

#### ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `.env`ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆï¼‰

```typescript
// Viteç’°å¢ƒå¤‰æ•°ã®ä½¿ç”¨ä¾‹
const apiKey = import.meta.env["VITE_GOOGLE_MAPS_API_KEY"];
const mapId = import.meta.env["VITE_GOOGLE_MAPS_MAP_ID"];
```

**å®Ÿè£…ä¾‹**: [`src/App.tsx`](../src/App.tsx) - Line 51

#### ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**: React useEffectã§ã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```typescript
useEffect(() => {
  const cleanup = setupMapEventListeners();
  return cleanup; // å¿…ãšé©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œ
}, []);
```

**å‚è€ƒå®Ÿè£…**: [`src/components/Map.tsx`](../src/components/Map.tsx) - useEffect
hooks

#### å‹å®‰å…¨æ€§ã®ç¢ºä¿

**å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«**: [`src/types/google-maps.ts`](../src/types/google-maps.ts)

**å®Ÿè£…ä¾‹**:
[`src/components/GoogleMarkerCluster.tsx`](../src/components/GoogleMarkerCluster.tsx)

å‹ã‚¬ãƒ¼ãƒ‰ã®ä½¿ç”¨ä¾‹ï¼š

```typescript
// å‹ã‚¬ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸå®‰å…¨ãªå‹å¤‰æ›
if (isClusterPOI(poi)) {
  // ClusterPOIå‹ã¨ã—ã¦å®‰å…¨ã«ä½¿ç”¨å¯èƒ½
  zoomToCluster(poi);
}
```

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦é–‹ç™ºã™ã‚‹ã“ã¨ã§ã€é«˜æ€§èƒ½ã§ä½¿ã„ã‚„ã™ã„Google
Mapsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
